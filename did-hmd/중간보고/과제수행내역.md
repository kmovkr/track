# 과제 수행 내역

## 과제 수행 한눈에 보기
### 최종 목표
 - [x] 블록체인 기반 자기주권형 모바일 출입서비스 개발
 - [x] 영지식 기반 증명서 발행 및 검증
 - [x] 블록체인 기반 조선소 출입신청 및 관리를 위한 self 단말기 인증 시스템 적용 

### 세부 목표
 - [ ] Hyperledger 블록체인 네트워크 동작을 위한 Private 블록체인 메인서버 구축
   - 기존 체인에 steward로 참여하는 방안 고려
 - [x] 방문객 출입 절차 간소화 시스템 적용
 - [ ] 주요 성능치 TPS  -  Read  테스트 전
 - [ ] 송 수신률/정확도 99.9% 이상 - 테스트 전
 - [x] Git을 이용한 형상관리
 - [x] github을 통한 이슈 및 태스크 관리 
 - [x] 도커를 이용한 서버 배포
 
## 1차년도 목표

### 개발 목표
**어플리케이션 개발 측면**
 - [x] 블록체인(DID) 기반 조선소 출입 관리 프로세스 정립
 - [x] 디지털 자기주권을 기반으로 출입증 발급시 중개자 없이 개인의 신원을 증명
 - [x] 개인정보를 내 단말에 저장하고, 필요시 직접 제출할 수 있는 서비스 개발
 - [ ] 신뢰 기반의 증명서 발행과 증명서 검증이 가능한 DID (Decentralized ID)
블록 체인 인프라 구성
 - [ ] Hyperledger 블록체인 네트워크 동작을 위한 Private 블록체인 메인서버 구축
   - Sovrin네트워크 이용 예정

**영지식 증명 기반 증명서 발행 및 검증**
  - [x] 영지식증명을 통해 사용자의 익명성을 보장하면서 증명서의 소유자임을 증명
  - [x] 소유권 증명을 위해 증명서 내에 DID를 직접 명시함으로써 발생 할
수 있는 프라이버시 및 보안 문제해결
  - [ ] 자기주권형 모바일 전자증명 서비스는 블록체인 네트워크와 플랫폼 SDK를
이용해 DID(Decentralized Identifier)기반의 증명서 발행 및 제출/검증을 위한 플랫폼 제공
 - [ ] 조선소 출입 신청 및 관리를 위한 키오스크 인증 시스템 외주 관리 
 - [x] 바코드 및 QR코드 인식 가능한 키오스크 활용

 **프로젝트 관리 측면**
  - [x] 소스 GIT 형상관리 및 히스토리 사용 
    - 자체 깃 서버 운영 --> Github Team 구매 사용
  - [x] 프로젝트 관리 및 협업 툴사용 ( github  issue관리, Gsuite사용)
  - [x] Cloud 서버 사용 ( AWS EC2 사용 )
  - [x] 각 단계 산출물은 구글 드라이브 사용(코드는 github사용하여 관리)
  
**표준화 관리**
 - 코딩 방식
   - [x] 개발 코드는 각 언어에 맞는 Convention사용 ( EsLint 사용을 통한 획일화)
   - [ ] SQL 은 표준 SQL사용( SQL대신 ORM사용)
 - 서버 구축
  - [x] Docker & Docker-Compose를 이용한 서버 Deploy절차 간소 & 자동화
- 법 제도적 측면
  - [x] 오픈소스 프로젝트 활용(Hyperledger Indy & Aries & Ursa 활용)

 
## 주차별 과제수행 계획
[gantt.pdf](https://github.com/kmovkr/track/files/5074313/gantt.pdf)
![image](https://user-images.githubusercontent.com/65800411/90244900-a12aea80-de6c-11ea-9657-6075ab481f8a.png)
 - 모델링 과정에는 에이전트 개발을 위한  Hyperledger Aries의 코드 및 각종  API분석을 포함하여, 실제 발급 검증과정을 어떻게 진행하며, 어떠한 구성요소들이 필요한지를 검토하고 정리하는 기간이었습니다.

 - 현재까지 발급자와 검증자의 어플리케이션은 기초단계 개발을 완료하였고, 스테이징 네트워크를 이용하여 실제 블록이 쌓이는 것을 관찰 할 수 있습니다.

 - 모바일 어플리케이션의 경우 Trinsic Wallet을 사용 하고 있습니다. Trinsic Wallet은 캐나다 정부에서 사용하고 있는 두가지 지갑중 하나입니다. 추후 앱 내부에 조선소 특화기능을 더 추가할 경우에 개발이필요하여 모델링을 하고 있습니다. 
 
 - 중간 보고 이후 고도화 /  배포 및 검증에서는 에이전트와 연결된 네트워크들을 스테이징 네트워크가 아닌 실제 네트워크로 변경 예정입니다. 또한 하나의 에이전트에 멀티 컨트롤러 구조로 변경할 예정입니다.

 - 모바일 월렛 앱 개발의 경우는 필요 및 기간에 따라 유동적으로 조절 할 예정입니다.

## 과제 수행에 툴 사용
 - github을 통한 코드 형상관리
![image](https://user-images.githubusercontent.com/65800411/90247601-e43b8c80-de71-11ea-8b45-e2a07cfa502e.png)
*스마트벤처선박 깃허브 팀 계정 레포지토리들*

 - swagger API를 사용한  api문서화
![image](https://user-images.githubusercontent.com/65800411/90247653-fddcd400-de71-11ea-8d42-66d23552a1e6.png)
 *발급자의 Swagger API 화면*

##  어플리케이션 구성도 개요
### 구성도
![image](https://user-images.githubusercontent.com/65800411/90245197-2b734e80-de6d-11ea-9f0b-84be1cbf4571.png)
*어플리케이션 구성도*
- 개발 구성도로 발급자, 사용자, 검증자의 관계가 간단하게 표현되어있습니다.
- 발급자와 검증자의 경우는 컨트롤러와 에이전트로 이루어져있습니다.
- 사용자의 경우는 에이전트 기능을 포함하는 모바일 어플리케이션으로 구성되어 있습니다.


## 개발 대상 
### 발급자(Issuer)

#### 발급자 기능
 - 발급자는 새로운 스키마를 정의하고 네트워크에 쓸 수 있습니다(API만제공)
 - 발급자는 네트워크에 존재하는 스키마에 대하여 신원정의(credential definition)을 할 수 있습니다.
 - 발급자는 신원정의에 맞는 신원을 사용자에게 제공 할 수 있습니다.
 - 발급자는 신원정의(credential definition)에 발급취소 기능(revocation registry)을 추가 할 수 있습니다.
 - 발급자는 발급된 신원에 대하여 취소(revoke) 할 수 있습니다.

#### 신원정의 네트워크에 쓰기
![image](https://user-images.githubusercontent.com/65800411/90332683-db75c280-dff9-11ea-943d-f9ed4f73c058.png)


 신원정의를 네트워크에 쓴 기록(staging 네트워크는 주기적으로 초기화를 하기때문에 유효하지 않은 링크 일 수 있습니다.)
http://test.bcovrin.vonx.io/browse/domain?page=1&query=32b7eeketvbCkQELA14qqn&txn_type=102

####  발급자와 사용자간의 시퀀스 다이어그램
![issue_detail (1) 복사본](https://user-images.githubusercontent.com/65800411/90247327-4d6ed000-de71-11ea-95d9-04239f489740.jpg)

 - 사용자인 Holder와 신원발급자가 통신하는 내용입니다.
 - 기본적인 플로우는 다음과 같습니다.
    1. 사용자가 신원 신청페이지에서 신청서를 작성하고 본인의 저장매체(이하 월렛)를 이용하여  사용자와 연결을 맺습니다.
    2. 관리자는 신원을 발급 할지를 결정 한 뒤, 관리자페이지에서 발급버튼을 누릅니다.
    3. 앞에서 맺어진 연결을 통하여 DID통신을 통하여 신원을 전달합니다.
    4. 사용자는 월렛으로 온 신원을 수락합니다.

 

#### 출입 신청 페이지 및 DID 연결 페이지

![image](https://user-images.githubusercontent.com/65800411/90252210-0d601b00-de7a-11ea-8053-f2855687bb16.png)

 - 출입(신원) 신청 페이지
 - 작성 내용을 제출하기 위하여 제공하는 QR코드

#### 출입 신청 확인 및 신원 발급
![image](https://user-images.githubusercontent.com/65800411/90252260-236ddb80-de7a-11ea-8467-7d9324d9f1f6.png)

 - 신원 신청자 목록페이지
 - 신원 신청 내역 세부페이지
 - 신원 신청 승인 페이지
 - 신원 발급 목록 페이지
 - 신원 발급 내역 세부 페이지

---


### 검증자(Verifier)
#### 검증자 기능
 - 검증자는 네트워크에 있는 필요한 신원들을 조합하여 신원 요청을 만들 수 있습니다.
 - 검증자는 QR 코드를 사용해 사용자와 연결(connection)을 맺을 수 있습니다.
 - 검증자는 사용자와의 연결(connection)을 통하여 신원 검증을 할 수 있습니다.
 - 검증자는 사용자의 신원이 취소되지 않았음(non-revoked)를 확인 할 수 있습니다
 - 검증자는 제출된 신원이 위조되지 않았음을 확인 할 수 있습니다.
 - 검증자는 신원에 포함된 값 혹은 값을 드러내지않고 숫자의 크고 작음(ex 19세 이상) 에 대한 확인 요청을 보낼 수 있습니다.


#### 검증자와 사용자간의 시퀀스 다이어그램

![verify_detail 복사본](https://user-images.githubusercontent.com/65800411/90247297-3cbe5a00-de71-11ea-9bd8-2b8093078053.jpg)

 - 사용자인 Holder와 검증자가 통신하는 내용입니다.
 - 기본적인 플로우는 다음과 같습니다.
    1. 검증자의 키오스크에서 초대를 QR코드로 제공합니다.
    2. 사용자는 월렛을 사용하여 연결을 맺습니다.
    3. 검증자는 연결이 완료되면 해당월렛으로 신원 확인 요청을 보냅니다.
    4. 사용자는 답신(Present Proof)으로 증명가능한 신원(Verifiable Proof)을 보냅니다.
    5. 검증 완료후 게이트를 오픈하고 검증자의 키오스크는 초기상태로 돌아갑니다.


####  검증 요청 화면(QR코드)

![image](https://user-images.githubusercontent.com/65800411/90252348-44cec780-de7a-11ea-8247-41c98735bde0.png)

---

### 사용자(Holder, Prover)

#### 사용자 기능
 - 사용자는 발급자로부터 신원 받아 보관 할 수 있습니다.
 - 사용자는 여러 신원을 조합하여 신원 인증을 할 수 있습니다.
 - 사용자는 ZKP를 통하여 신원의 값을 드러내지 않고도 신원 인증을 할 수 있습니다.

#### 월렛 사용 이미지

![IMG_1637](https://user-images.githubusercontent.com/65800411/90333945-ef72f180-e004-11ea-8d01-bbb031372ba2.PNG)

 - 출입증을 제안받은 화면 1, 2
 - 출입증 및 교육이수증 리스트
 - 출입증 세부내용 화면




